{
  "feature": "Word Document Export",
  "workflow_type": "feature",
  "workflow_rationale": "This is a new capability being added to the application. It requires creating new services, IPC handlers, and UI components while preserving existing PDF export functionality. The task involves both backend document generation logic and frontend UI changes for format selection.",
  "phases": [
    {
      "id": "phase-1-setup",
      "name": "Project Setup",
      "type": "setup",
      "description": "Install docx dependency and verify it's importable",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Install docx npm package",
          "service": "main",
          "files_to_modify": [
            "package.json"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && npm ls docx",
            "expected": "docx@"
          },
          "status": "completed",
          "notes": "Added docx ^9.4.1 to package.json dependencies. Note: npm install needs to be run to actually install the package (npm commands restricted in sandbox).",
          "updated_at": "2026-01-07T07:12:34.602395+00:00"
        }
      ]
    },
    {
      "id": "phase-2-types",
      "name": "Type Definitions & Validation",
      "type": "implementation",
      "description": "Add TypeScript types and Zod validation schemas for Word export",
      "depends_on": [
        "phase-1-setup"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Add Word export types to IPC contracts",
          "service": "main",
          "files_to_modify": [
            "src/shared/types/ipc-contracts.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/shared/types/ipc-contracts.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && grep -l 'ExportDocxRequest' src/shared/types/ipc-contracts.ts",
            "expected": "src/shared/types/ipc-contracts.ts"
          },
          "status": "completed",
          "notes": "Added DOCX channel types (ExportDocxRequest, ExportDocxResponse) and ElectronAPI.docx.export method to ipc-contracts.ts. Follows existing PDF channel patterns. Verification passed.",
          "updated_at": "2026-01-07T07:14:08.835460+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Add Zod validation schemas for Word export",
          "service": "main",
          "files_to_modify": [
            "src/shared/validation/schemas.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/shared/validation/schemas.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && grep -l 'exportDocxSchema' src/shared/validation/schemas.ts",
            "expected": "src/shared/validation/schemas.ts"
          },
          "status": "completed",
          "notes": "Added exportDocxSchema Zod validation schema and ExportDocxInput type export to schemas.ts. Schema validates projectId (UUID), outputPath (file path), openAfterExport (optional boolean), and mermaidDiagrams (optional record). Follows existing exportPDFSchema pattern exactly. Verification passed.",
          "updated_at": "2026-01-07T07:15:54.106169+00:00"
        }
      ]
    },
    {
      "id": "phase-3-elements",
      "name": "Element Converters",
      "type": "implementation",
      "description": "Create docx element converters for each markdown element type",
      "depends_on": [
        "phase-1-setup"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create Heading element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/Heading.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/Heading.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Heading.ts element converter with support for: heading levels H1-H6, theme-based styling (fonts, colors, sizes), inline formatting (bold, italic, code, links, strikethrough), text alignment, and proper DXA unit conversions for spacing. Follows patterns from MarkdownElements.tsx PDF implementation.",
          "updated_at": "2026-01-07T07:18:03.613275+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Create Paragraph element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/Paragraph.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/Paragraph.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Paragraph.ts element converter with support for: theme-based styling (bodyFont, bodySize, textColor), inline formatting (bold, italic, code, links, strikethrough), text alignment, and proper DXA unit conversions for spacing. Follows patterns from Heading.ts implementation.",
          "updated_at": "2026-01-07T07:19:40.831239+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Create List element converter (ordered and unordered)",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/List.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/List.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created List.ts element converter with support for: ordered lists (numbered 1., 2., etc.), unordered lists (bullet \u2022), nested lists via indentLevels, inline formatting (bold, italic, code, links, strikethrough), proper indentation using DXA units, and margin spacing between items. Follows patterns from Heading.ts and Paragraph.ts implementations.",
          "updated_at": "2026-01-07T07:22:06.179019+00:00"
        },
        {
          "id": "subtask-3-4",
          "description": "Create CodeBlock element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/CodeBlock.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/CodeBlock.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created CodeBlock.ts element converter for DOCX export. Follows established patterns from Heading.ts, Paragraph.ts, and List.ts. Features: monospace Courier New font, theme-based background shading, preserved whitespace indentation with non-breaking spaces, line-by-line paragraph rendering.",
          "updated_at": "2026-01-07T07:24:13.742447+00:00"
        },
        {
          "id": "subtask-3-5",
          "description": "Create Table element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/Table.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/Table.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Table.ts element converter for DOCX export with support for: header rows with bold text and background shading, data rows with proper cell styling, theme-based fonts/colors/sizes, BorderStyle.SINGLE borders, cell padding via DXA margins, percentage-based column widths, and graceful handling of varying column counts.",
          "updated_at": "2026-01-07T07:25:57.081528+00:00"
        },
        {
          "id": "subtask-3-6",
          "description": "Create Image element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/Image.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/Image.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Image.ts element converter with support for: base64 data URLs, local file paths (with file:// prefix handling), fallback placeholders for remote URLs and errors. Uses ImageRun from docx library with centered alignment and optional alt text caption. Commit: 2db6a9e",
          "updated_at": "2026-01-07T07:28:43.823922+00:00"
        },
        {
          "id": "subtask-3-7",
          "description": "Create Blockquote element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/Blockquote.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/Blockquote.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Blockquote.ts element converter for DOCX export with: left border (3pt) in heading color, left indent (15pt) for margin spacing, italic text styling, inline formatting support (bold, italic, code, links, strikethrough). Follows patterns from Paragraph.ts and PDF BlockquoteElement. Commit: 1b3ec87",
          "updated_at": "2026-01-07T07:30:41.099164+00:00"
        },
        {
          "id": "subtask-3-8",
          "description": "Create HorizontalRule element converter",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/HorizontalRule.ts"
          ],
          "patterns_from": [
            "src/main/pdf/components/MarkdownElements.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/HorizontalRule.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created HorizontalRule.ts element converter that converts markdown horizontal rule elements to DOCX paragraphs with a bottom border. Uses standard patterns: spacing in DXA units, colors without '#' prefix, BorderStyle.SINGLE with 1pt width.",
          "updated_at": "2026-01-07T07:32:05.420641+00:00"
        },
        {
          "id": "subtask-3-9",
          "description": "Create barrel file for element exports",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/elements/index.ts"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/elements/index.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created barrel file index.ts that exports all 8 DOCX element converters: createHeadingParagraph, createParagraphElement, createListParagraphs, createCodeBlockParagraphs, createTableElement, createImageParagraph, createBlockquoteElement, createHorizontalRuleElement. Uses .js extension in imports for ESM compatibility. Commit: 2219a44",
          "updated_at": "2026-01-07T07:33:24.134656+00:00"
        }
      ]
    },
    {
      "id": "phase-4-document-builder",
      "name": "Document Builder",
      "type": "implementation",
      "description": "Create the main document builder that assembles elements into a Word document",
      "depends_on": [
        "phase-3-elements"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create Document.ts builder that converts markdown elements to Word document",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/docx/Document.ts"
          ],
          "patterns_from": [
            "src/main/pdf/Document.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f src/main/docx/Document.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Document.ts builder that converts markdown elements to Word document. Features: parseMarkdown() integration from pdf/markdown-parser, all element type handling (heading, paragraph, list, checklist, codeBlock, blockquote, horizontalRule, image, table, mermaidDiagram, pageBreak), theme-based styling, Mermaid diagram support via data URLs, docx Packer buffer generation. Follows patterns from pdf/Document.tsx. Commit: 7644335",
          "updated_at": "2026-01-07T07:36:00.707250+00:00"
        }
      ]
    },
    {
      "id": "phase-5-service",
      "name": "Word Export Service",
      "type": "implementation",
      "description": "Create the main docx service for document generation and export",
      "depends_on": [
        "phase-4-document-builder"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create docx-service.ts with generateDocx and exportDocx functions",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/main/services/docx-service.ts"
          ],
          "patterns_from": [
            "src/main/services/pdf-service.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && grep -l 'generateDocx' src/main/services/docx-service.ts",
            "expected": "src/main/services/docx-service.ts"
          },
          "status": "completed",
          "notes": "Created docx-service.ts with generateDocx, exportDocx, and previewDocx functions following the pdf-service.ts pattern exactly. Features: theme-based styling, mermaid diagram support, proper error handling with console logging. Commit: 75ada65",
          "updated_at": "2026-01-07T07:37:28.247021+00:00"
        }
      ]
    },
    {
      "id": "phase-6-ipc",
      "name": "IPC Integration",
      "type": "implementation",
      "description": "Add IPC handlers and expose Word export API to renderer",
      "depends_on": [
        "phase-5-service",
        "phase-2-types"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Add docx:export IPC handler",
          "service": "main",
          "files_to_modify": [
            "src/main/ipc/handlers.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/main/ipc/handlers.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && grep -l 'docx:export' src/main/ipc/handlers.ts",
            "expected": "src/main/ipc/handlers.ts"
          },
          "status": "completed",
          "notes": "Added docx:export IPC handler to handlers.ts. Follows pdf:export pattern exactly: imports exportDocxSchema for validation, imports generateDocx and exportDocx from docx-service, handler retrieves project with theme, reads content from file, generates DOCX buffer, exports to output path, and optionally opens file after export. Commit: 5a44957",
          "updated_at": "2026-01-07T07:39:13.021032+00:00"
        },
        {
          "id": "subtask-6-2",
          "description": "Expose Word export methods in preload.ts",
          "service": "main",
          "files_to_modify": [
            "src/main/preload.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/main/preload.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && grep -l 'docx' src/main/preload.ts",
            "expected": "src/main/preload.ts"
          },
          "status": "completed",
          "notes": "Added docx namespace to preload.ts electronAPI object with export method that invokes \"docx:export\" IPC channel. Follows existing patterns from pdf, cover, and other namespaces. Verification passed: grep found 'docx' in preload.ts. Commit: 51c71cd",
          "updated_at": "2026-01-07T07:40:34.936447+00:00"
        }
      ]
    },
    {
      "id": "phase-7-ui",
      "name": "UI Integration",
      "type": "implementation",
      "description": "Add export format selection UI in the editor view",
      "depends_on": [
        "phase-6-ipc"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Add export format selection dropdown to EditorView",
          "service": "renderer",
          "files_to_modify": [
            "src/renderer/views/EditorView.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/renderer/views/EditorView.tsx"
          ],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && grep -l 'Export Word' src/renderer/views/EditorView.tsx || grep -l 'docx' src/renderer/views/EditorView.tsx",
            "expected": "src/renderer/views/EditorView.tsx"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-8-tests",
      "name": "Unit Tests",
      "type": "implementation",
      "description": "Add unit tests for Word document generation service",
      "depends_on": [
        "phase-5-service"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-8-1",
          "description": "Create unit tests for docx-service",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [
            "tests/unit/docx-service.test.ts"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && test -f tests/unit/docx-service.test.ts && echo 'OK'",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-9-integration",
      "name": "Integration Testing",
      "type": "integration",
      "description": "Verify end-to-end Word export flow works correctly",
      "depends_on": [
        "phase-7-ui",
        "phase-8-tests"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-9-1",
          "description": "End-to-end verification of Word export flow",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Start dev server with npm run dev",
              "Create or open a project",
              "Add content with headings, lists, code blocks",
              "Click Export and select Word format",
              "Choose save location",
              "Verify .docx file is created",
              "Open file in Word/LibreOffice to verify content"
            ]
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 9,
    "total_subtasks": 17,
    "services_involved": [
      "main",
      "renderer",
      "tests"
    ],
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": [
            "phase-2-types",
            "phase-3-elements"
          ],
          "reason": "Both depend only on phase-1-setup, different file sets"
        },
        {
          "phases": [
            "phase-7-ui",
            "phase-8-tests"
          ],
          "reason": "UI work can happen while tests are being written, independent file sets"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Element converters can be parallelized but service work is sequential"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 001 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit",
      "integration"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All existing tests pass",
      "New unit tests pass for docx-service",
      "Word documents can be generated and exported",
      "Generated .docx files open correctly in Word/LibreOffice",
      "Existing PDF export still works",
      "No console errors during export"
    ],
    "verification_steps": [
      {
        "name": "TypeScript Compilation",
        "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && npm run build",
        "expected_outcome": "Build completes without errors",
        "type": "build",
        "required": true,
        "blocking": true
      },
      {
        "name": "Unit Tests",
        "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && npm test",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Linting",
        "command": "cd /Users/gustavogomez/projects/InkPot/InkPot && npm run lint",
        "expected_outcome": "No linting errors",
        "type": "lint",
        "required": false,
        "blocking": false
      }
    ],
    "reasoning": "Medium risk change requires unit tests and manual verification. The docx library is well-tested but we need to ensure proper integration with existing markdown parsing infrastructure."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "npm test"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [],
      "services_to_test": [
        "main"
      ]
    },
    "e2e_tests": {
      "required": false,
      "commands": [],
      "flows": [
        "export-word"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:3000/",
          "checks": [
            "renders",
            "no-console-errors"
          ]
        },
        {
          "url": "http://localhost:3000/editor/:projectId",
          "checks": [
            "export-button-visible",
            "format-selection-works"
          ]
        }
      ]
    },
    "database_verification": {
      "required": false,
      "checks": []
    },
    "manual_verification": {
      "required": true,
      "checks": [
        "Open exported .docx in Microsoft Word",
        "Open exported .docx in LibreOffice Writer",
        "Verify headings render with correct sizes",
        "Verify lists render correctly",
        "Verify code blocks have monospace font",
        "Verify tables have proper structure",
        "Verify images are embedded correctly"
      ]
    }
  },
  "qa_signoff": null,
  "status": "in_progress",
  "planStatus": "in_progress",
  "updated_at": "2026-01-07T07:11:30.898Z",
  "last_updated": "2026-01-07T07:40:34.936458+00:00"
}