// InkPot Prisma Schema
// Local-first SQLite database for metadata storage

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./inkpot.db"
}

// ============================================================================
// PROJECTS
// ============================================================================

model Project {
  id       String  @id @default(uuid())
  name     String
  filePath String  @unique // Absolute path to .inkpot project file
  themeId  String?

  // Cover page configuration
  hasCoverPage    Boolean @default(false)
  coverTitle      String?
  coverSubtitle   String?
  coverAuthor     String?
  coverDate       String?
  coverTemplateId String?

  // Table of Contents configuration
  hasToc       Boolean @default(true) // Enable/disable TOC generation
  tocMinLevel  Int     @default(1) // Minimum heading level to include (1-6)
  tocMaxLevel  Int     @default(3) // Maximum heading level to include (1-6)

  // Metadata
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  lastOpenedAt DateTime @default(now())

  // Relationships
  theme         Theme?              @relation(fields: [themeId], references: [id], onDelete: SetNull)
  coverTemplate CoverTemplate?      @relation(fields: [coverTemplateId], references: [id], onDelete: SetNull)
  coverAssets   ProjectCoverAsset[]

  @@index([lastOpenedAt])
}

// ============================================================================
// THEMES
// ============================================================================

model Theme {
  id        String  @id @default(uuid())
  name      String  @unique
  isBuiltIn Boolean @default(false) // True for bundled themes

  // Typography
  headingFont String // Google Font family name
  bodyFont    String // Google Font family name
  h1Size      Float  @default(32) // points
  h2Size      Float  @default(24)
  h3Size      Float  @default(20)
  h4Size      Float  @default(16)
  h5Size      Float  @default(14)
  h6Size      Float  @default(12)
  bodySize    Float  @default(11)

  // Spacing
  kerning Float @default(0) // letter-spacing in em
  leading Float @default(1.5) // line-height multiplier

  // Layout
  pageWidth    Float @default(8.5) // inches
  pageHeight   Float @default(11) // inches
  marginTop    Float @default(1) // inches
  marginBottom Float @default(1)
  marginLeft   Float @default(1)
  marginRight  Float @default(1)

  // Colors (hex format)
  backgroundColor String @default("#FFFFFF")
  textColor       String @default("#000000")
  headingColor    String @default("#000000")
  linkColor       String @default("#0066CC")
  linkUnderline   Boolean @default(true) // Underline links for accessibility
  codeBackground  String @default("#F5F5F5")

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  projects Project[]

  @@index([name])
}

// ============================================================================
// COVER TEMPLATES
// ============================================================================

model CoverTemplate {
  id        String  @id @default(uuid())
  name      String  @unique
  isBuiltIn Boolean @default(false)

  // Layout definition (JSON structure defining element positions)
  layoutJson String // Serialized layout configuration

  // Asset slots
  hasLogoSlot       Boolean @default(false)
  hasBackgroundSlot Boolean @default(false)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  projects Project[]

  @@index([name])
}

// ============================================================================
// PROJECT COVER ASSETS
// ============================================================================

model ProjectCoverAsset {
  id        String @id @default(uuid())
  projectId String
  assetType String // 'logo' | 'background'

  // File information
  originalFileName String
  filePath         String // Absolute path to asset file
  fileSize         Int // bytes
  mimeType         String // 'image/png' | 'image/jpeg' | 'image/svg+xml'
  width            Int? // pixels
  height           Int? // pixels

  // Metadata
  createdAt DateTime @default(now())

  // Relationships
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, assetType])
}

// ============================================================================
// RECENT PROJECTS (For quick access list)
// ============================================================================

model RecentProject {
  id        String @id @default(uuid())
  projectId String @unique
  position  Int // Order in recent list (0 = most recent)

  // Metadata
  accessedAt DateTime @default(now())

  @@index([position])
}

// ============================================================================
// APPLICATION SETTINGS
// ============================================================================

model AppSetting {
  key   String @id
  value String // JSON-serialized value

  // Metadata
  updatedAt DateTime @updatedAt
}

// ============================================================================
// CACHED FONTS (Google Fonts cache)
// ============================================================================

model CachedFont {
  id       String @id @default(uuid())
  family   String @unique // Font family name
  variant  String // 'regular', '700', 'italic', etc.
  filePath String // Absolute path to cached .woff2 file
  fileSize Int // bytes

  // Metadata
  downloadedAt DateTime @default(now())

  @@index([family])
}
